# 前端设计与实现

本文档详细说明 DistributedJob 前端的设计和实现方案。

## 技术栈概述

DistributedJob 的前端采用现代化的技术栈进行开发，包括：

- **构建工具**：Vite
- **编程语言**：TypeScript
- **框架**：Vue 3 (Composition API)
- **UI 组件库**：Element Plus
- **状态管理**：Pinia
- **路由**：Vue Router
- **HTTP 客户端**：Axios
- **CSS 预处理器**：SCSS

## 项目结构

前端项目采用模块化设计，目录结构如下：

```
web-ui/
├── public/                 # 静态资源
│   ├── favicon.ico
│   └── logo.png
├── src/                    # 源代码
│   ├── api/                # API 接口封装
│   │   ├── auth.ts         # 认证相关接口
│   │   ├── department.ts   # 部门管理接口
│   │   ├── task.ts         # 任务管理接口
│   │   ├── record.ts       # 执行记录接口
│   │   ├── user.ts         # 用户管理接口
│   │   ├── role.ts         # 角色管理接口
│   │   └── http.ts         # Axios 实例和拦截器
│   ├── assets/             # 静态资源
│   │   ├── images/         # 图片资源
│   │   └── styles/         # 样式文件
│   ├── components/         # 公共组件
│   │   ├── common/         # 通用组件
│   │   ├── layout/         # 布局组件
│   │   └── business/       # 业务组件
│   ├── hooks/              # 自定义钩子
│   ├── router/             # 路由配置
│   │   ├── index.ts        # 路由入口
│   │   └── routes.ts       # 路由定义
│   ├── store/              # 状态管理
│   │   ├── modules/        # 状态模块
│   │   └── index.ts        # 状态入口
│   ├── utils/              # 工具函数
│   │   ├── auth.ts         # 权限工具
│   │   ├── date.ts         # 日期工具
│   │   ├── validator.ts    # 表单验证工具
│   │   └── storage.ts      # 本地存储工具
│   ├── views/              # 页面组件
│   │   ├── auth/           # 认证相关页面
│   │   ├── dashboard/      # 仪表盘页面
│   │   ├── task/           # 任务管理页面
│   │   ├── record/         # 记录查询页面
│   │   ├── department/     # 部门管理页面
│   │   ├── user/           # 用户管理页面
│   │   └── role/           # 角色管理页面
│   ├── App.vue             # 根组件
│   ├── main.ts             # 入口文件
│   ├── env.d.ts            # 类型声明
│   └── permission.ts       # 路由权限控制
├── .env                    # 环境变量
├── .env.development        # 开发环境变量
├── .env.production         # 生产环境变量
├── index.html              # HTML 模板
├── package.json            # 项目配置
├── tsconfig.json           # TypeScript 配置
├── vite.config.ts          # Vite 配置
└── README.md               # 项目说明
```

## 功能模块设计

### 认证模块

认证模块负责用户登录、登出、刷新令牌等功能：

1. **登录页面**：包含用户名和密码输入框，提交后获取访问令牌
2. **令牌管理**：使用 localStorage 或 sessionStorage 安全存储令牌
3. **自动刷新**：令牌过期前自动刷新
4. **请求拦截**：为 API 请求自动添加认证头

### 布局组件

布局组件定义了应用的整体结构：

1. **侧边栏**：包含系统导航菜单，基于用户权限动态显示
2. **顶栏**：显示当前用户信息、消息通知和系统操作
3. **标签页**：支持多页面标签式导航
4. **主内容区**：展示当前活动页面内容

### 部门管理

部门管理模块实现部门的增删改查功能：

1. **部门树**：以树形结构展示部门层次关系
2. **部门表单**：创建和编辑部门的表单
3. **批量操作**：支持批量启用/禁用部门

### 用户权限管理

用户权限管理包括用户和角色的管理：

1. **用户列表**：展示所有用户，支持筛选和分页
2. **用户表单**：创建和编辑用户的表单
3. **角色列表**：展示所有角色
4. **角色表单**：创建和编辑角色，分配权限的表单
5. **权限树**：以树形结构展示权限层次关系

### 任务管理

任务管理实现定时任务的管理功能：

1. **任务列表**：展示所有任务，支持筛选、排序和分页
2. **HTTP 任务表单**：创建和编辑 HTTP 任务的表单
3. **gRPC 任务表单**：创建和编辑 gRPC 任务的表单
4. **Cron 表达式生成器**：可视化构建 Cron 表达式的工具
5. **任务状态切换**：快速启用/禁用任务的开关

### 执行记录查询

执行记录查询模块展示任务的执行历史：

1. **记录列表**：支持多条件筛选和分页的执行记录列表
2. **记录详情**：展示单次执行的详细信息，包括请求和响应
3. **统计图表**：展示任务执行成功率、耗时分布等统计信息
4. **导出功能**：支持导出执行记录为 Excel 或 CSV 格式

### 仪表盘

仪表盘提供系统概览：

1. **任务概况**：展示任务总数、今日执行数、成功率等
2. **部门任务分布**：展示各部门的任务数量分布
3. **执行趋势图**：展示过去一段时间内的任务执行趋势
4. **最近执行记录**：展示最近的执行记录
5. **异常任务预警**：展示执行异常频繁的任务列表

## 状态管理

使用 Pinia 进行状态管理，主要模块包括：

1. **用户状态**：存储当前登录用户信息和权限
2. **应用状态**：存储应用全局配置和主题设置
3. **任务状态**：存储任务列表和筛选条件
4. **部门状态**：存储部门树和选中部门
5. **标签页状态**：存储已打开的标签页信息

## 权限控制

权限控制分为两层：

1. **路由级权限**：
   - 基于用户角色控制可访问的路由
   - 未授权访问自动重定向到登录页或 403 页面

2. **组件级权限**：
   - 自定义指令 `v-permission` 控制组件显示与否
   - 基于权限代码和角色判断是否有操作权限

## 主题定制

支持明暗两种主题模式和主题色自定义：

1. **明暗主题切换**：支持系统跟随、浅色模式和深色模式三种选项
2. **主题色自定义**：提供主题色选择器，可自定义系统主题色
3. **组件样式变量**：覆盖 Element Plus 的样式变量实现统一风格

## API 请求处理

使用 Axios 进行 API 请求，主要功能：

1. **请求拦截**：添加认证头、处理 URL 参数等
2. **响应拦截**：统一处理错误、刷新令牌等
3. **取消请求**：支持取消重复请求和过期请求
4. **API 模块化**：按业务模块拆分 API 文件

## 开发与构建

### 开发环境设置

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 生产环境构建

```bash
# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

### 类型检查

```bash
# 运行类型检查
npm run type-check
```

### 代码格式化和检查

```bash
# 格式化代码
npm run format

# 代码检查
npm run lint
```

## 性能优化

为确保前端应用的高性能，采取以下优化措施：

1. **代码分割**：利用 Vue Router 的动态导入功能，实现按需加载
2. **预加载关键资源**：提前加载可能使用的组件和资源
3. **虚拟列表**：对大数据量的列表使用虚拟滚动
4. **组件懒加载**：非关键组件采用懒加载方式
5. **资源压缩**：使用 Vite 的生产构建进行代码压缩和优化
6. **缓存策略**：实现本地缓存和 API 缓存策略

## 浏览器兼容性

前端应用支持以下现代浏览器：

- Chrome >= 87
- Firefox >= 78
- Safari >= 14
- Edge >= 88

不支持 Internet Explorer。

## 移动端适配

采用响应式设计，支持在移动设备上使用：

1. **响应式布局**：基于 Grid 和 Flexbox 的响应式布局
2. **触摸优化**：优化触摸事件和交互
3. **自适应组件**：组件根据屏幕大小自动调整

## 国际化

支持多语言切换功能：

1. **中英文支持**：默认支持中文和英文
2. **语言文件管理**：使用 i18n 管理语言文件
3. **动态切换**：运行时切换语言无需刷新页面

## 可访问性

遵循 WCAG 2.1 AA 级标准：

1. **语义化 HTML**：使用语义化标签组织内容
2. **键盘可访问性**：确保所有功能可通过键盘操作
3. **屏幕阅读器支持**：提供适当的 ARIA 属性和标签
4. **足够的对比度**：文本和背景有足够的对比度

## 测试策略

前端测试策略包括：

1. **单元测试**：使用 Vitest 进行组件和工具函数的单元测试
2. **组件测试**：使用 Vue Test Utils 测试组件行为
3. **端到端测试**：使用 Cypress 进行端到端测试
4. **可视化测试**：使用 Storybook 进行组件可视化测试

## 部署

前端应用部署方式：

1. **静态文件部署**：构建后的静态文件可部署到任何 Web 服务器
2. **容器化部署**：提供 Docker 镜像与后端一起部署
3. **CDN 加速**：静态资源支持部署到 CDN 加速访问

## UI 样式规范

UI 设计遵循以下规范：

1. **配色方案**：使用统一的品牌配色方案
2. **字体规范**：定义标题、正文、标签等文字样式
3. **间距规范**：统一的边距和内边距规则
4. **组件样式**：基于 Element Plus 的统一组件样式
5. **图标系统**：使用 SVG 图标系统