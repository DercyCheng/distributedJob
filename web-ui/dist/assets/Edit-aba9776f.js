import{d as e,z as l,a,r as t,j as o,c as d,e as u,w as r,f as s,A as n,E as p,g as i,o as m,i as c,F as f,m as h,b as v,n as V,l as g,_ as y}from"./index-462fafd6.js";import{a as b,u as _,c as k}from"./task-3c60f998.js";import{g as U}from"./department-10f40862.js";const C={class:"task-edit-container"},E=y(e({__name:"Edit",setup(e){const y=s(),E=n(),T=l((()=>"TaskEdit"===E.name)),x=l((()=>T.value?parseInt(E.params.id):0)),P=a(),q=a(!1),w=a([]),R=a([]),I=t({name:"",description:"",type:"http",cronExpression:"0 0 * * *",departmentId:void 0,status:"active",config:{}}),O=t({url:"",method:"GET",headers:{},body:"",timeout:30,successCodes:[200]}),j=t({host:"",port:50051,service:"",method:"",request:"",timeout:30}),H={name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"change"}],cronExpression:[{required:!0,message:"请输入Cron表达式",trigger:"blur"}],departmentId:[{required:!0,message:"请选择所属部门",trigger:"change"}]},S=()=>{y.push("/task/list")},L=()=>{R.value.push({key:"",value:""})},G=async()=>{P.value&&await P.value.validate((async e=>{if(e){"http"===I.type?(O.headers=(()=>{const e={};return R.value.forEach((l=>{l.key&&l.value&&(e[l.key]=l.value)})),e})(),I.config=O):"grpc"===I.type&&(I.config=j),q.value=!0;try{T.value?(await _(x.value,I),p.success("任务更新成功")):(await k(I),p.success("任务创建成功")),S()}catch(l){p.error(l.message||(T.value?"更新任务失败":"创建任务失败"))}finally{q.value=!1}}}))},N=async()=>{if(T.value){q.value=!0;try{const l=await b(x.value);if(I.name=l.name,I.description=l.description,I.type=l.type,I.cronExpression=l.cronExpression,I.departmentId=l.departmentId,I.status=l.status,"http"===l.type){const a=l.config;O.url=a.url,O.method=a.method,O.body=a.body,O.timeout=a.timeout,O.successCodes=a.successCodes,R.value=(e=a.headers,Object.entries(e).map((([e,l])=>({key:e,value:l}))))}else if("grpc"===l.type){const e=l.config;j.host=e.host,j.port=e.port,j.service=e.service,j.method=e.method,j.request=e.request,j.timeout=e.timeout}}catch(l){p.error("获取任务详情失败"),S()}finally{q.value=!1}var e}};return o((()=>{(async()=>{try{w.value=await U()}catch(e){p.error("获取部门列表失败")}})(),N()})),(e,l)=>{const a=i("el-page-header"),t=i("el-divider"),o=i("el-input"),s=i("el-form-item"),n=i("el-radio"),p=i("el-radio-group"),y=i("el-option"),b=i("el-select"),_=i("el-input-number"),k=i("el-button"),U=i("el-form"),E=i("el-card");return m(),d("div",C,[u(a,{onBack:S,title:T.value?"编辑任务":"创建任务"},null,8,["title"]),u(E,{class:"mt-20"},{default:r((()=>[u(U,{ref_key:"formRef",ref:P,model:I,rules:H,"label-width":"120px","status-icon":""},{default:r((()=>[u(t,{"content-position":"left"},{default:r((()=>l[16]||(l[16]=[c("基本信息")]))),_:1}),u(s,{label:"任务名称",prop:"name"},{default:r((()=>[u(o,{modelValue:I.name,"onUpdate:modelValue":l[0]||(l[0]=e=>I.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),u(s,{label:"任务描述",prop:"description"},{default:r((()=>[u(o,{modelValue:I.description,"onUpdate:modelValue":l[1]||(l[1]=e=>I.description=e),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])])),_:1}),u(s,{label:"任务类型",prop:"type"},{default:r((()=>[u(p,{modelValue:I.type,"onUpdate:modelValue":l[2]||(l[2]=e=>I.type=e)},{default:r((()=>[u(n,{label:"http"},{default:r((()=>l[17]||(l[17]=[c("HTTP")]))),_:1}),u(n,{label:"grpc"},{default:r((()=>l[18]||(l[18]=[c("gRPC")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),u(s,{label:"执行计划",prop:"cronExpression"},{default:r((()=>[u(o,{modelValue:I.cronExpression,"onUpdate:modelValue":l[3]||(l[3]=e=>I.cronExpression=e),placeholder:"Cron表达式，如：0 0 * * *"},null,8,["modelValue"])])),_:1}),u(s,{label:"所属部门",prop:"departmentId"},{default:r((()=>[u(b,{modelValue:I.departmentId,"onUpdate:modelValue":l[4]||(l[4]=e=>I.departmentId=e),placeholder:"请选择部门"},{default:r((()=>[(m(!0),d(f,null,h(w.value,(e=>(m(),g(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"http"===I.type?(m(),d(f,{key:0},[u(t,{"content-position":"left"},{default:r((()=>l[19]||(l[19]=[c("HTTP请求配置")]))),_:1}),u(s,{label:"请求URL",prop:"config.url"},{default:r((()=>[u(o,{modelValue:O.url,"onUpdate:modelValue":l[5]||(l[5]=e=>O.url=e),placeholder:"请输入完整URL，包括http(s)://"},null,8,["modelValue"])])),_:1}),u(s,{label:"请求方法",prop:"config.method"},{default:r((()=>[u(b,{modelValue:O.method,"onUpdate:modelValue":l[6]||(l[6]=e=>O.method=e),placeholder:"请选择HTTP方法"},{default:r((()=>[u(y,{label:"GET",value:"GET"}),u(y,{label:"POST",value:"POST"}),u(y,{label:"PUT",value:"PUT"}),u(y,{label:"DELETE",value:"DELETE"})])),_:1},8,["modelValue"])])),_:1}),u(s,{label:"请求超时",prop:"config.timeout"},{default:r((()=>[u(_,{modelValue:O.timeout,"onUpdate:modelValue":l[7]||(l[7]=e=>O.timeout=e),min:1,max:60,step:1,"controls-position":"right"},null,8,["modelValue"]),l[20]||(l[20]=v("span",{class:"ml-10"},"秒",-1))])),_:1}),u(s,{label:"请求头",prop:"config.headers"},{default:r((()=>[u(k,{type:"primary",link:"",onClick:L},{default:r((()=>l[21]||(l[21]=[c("添加请求头")]))),_:1}),(m(!0),d(f,null,h(R.value,((e,a)=>(m(),d("div",{key:a,class:"header-item"},[u(o,{modelValue:R.value[a].key,"onUpdate:modelValue":e=>R.value[a].key=e,placeholder:"Key",class:"header-key"},null,8,["modelValue","onUpdate:modelValue"]),u(o,{modelValue:R.value[a].value,"onUpdate:modelValue":e=>R.value[a].value=e,placeholder:"Value",class:"header-value"},null,8,["modelValue","onUpdate:modelValue"]),u(k,{type:"danger",link:"",onClick:e=>(e=>{R.value.splice(e,1)})(a)},{default:r((()=>l[22]||(l[22]=[c("删除")]))),_:2},1032,["onClick"])])))),128))])),_:1}),u(s,{label:"请求体",prop:"config.body"},{default:r((()=>[u(o,{modelValue:O.body,"onUpdate:modelValue":l[8]||(l[8]=e=>O.body=e),type:"textarea",rows:5,placeholder:"请求体内容，支持JSON格式"},null,8,["modelValue"])])),_:1}),u(s,{label:"成功状态码",prop:"config.successCodes"},{default:r((()=>[u(b,{modelValue:O.successCodes,"onUpdate:modelValue":l[9]||(l[9]=e=>O.successCodes=e),multiple:"",placeholder:"请选择成功的HTTP状态码"},{default:r((()=>[u(y,{label:"200 - OK",value:200}),u(y,{label:"201 - Created",value:201}),u(y,{label:"202 - Accepted",value:202}),u(y,{label:"204 - No Content",value:204})])),_:1},8,["modelValue"])])),_:1})],64)):"grpc"===I.type?(m(),d(f,{key:1},[u(t,{"content-position":"left"},{default:r((()=>l[23]||(l[23]=[c("gRPC请求配置")]))),_:1}),u(s,{label:"Host",prop:"config.host"},{default:r((()=>[u(o,{modelValue:j.host,"onUpdate:modelValue":l[10]||(l[10]=e=>j.host=e),placeholder:"gRPC服务的主机地址"},null,8,["modelValue"])])),_:1}),u(s,{label:"Port",prop:"config.port"},{default:r((()=>[u(_,{modelValue:j.port,"onUpdate:modelValue":l[11]||(l[11]=e=>j.port=e),min:1,max:65535,step:1,"controls-position":"right"},null,8,["modelValue"])])),_:1}),u(s,{label:"Service",prop:"config.service"},{default:r((()=>[u(o,{modelValue:j.service,"onUpdate:modelValue":l[12]||(l[12]=e=>j.service=e),placeholder:"gRPC服务名称"},null,8,["modelValue"])])),_:1}),u(s,{label:"Method",prop:"config.method"},{default:r((()=>[u(o,{modelValue:j.method,"onUpdate:modelValue":l[13]||(l[13]=e=>j.method=e),placeholder:"gRPC方法名称"},null,8,["modelValue"])])),_:1}),u(s,{label:"Request",prop:"config.request"},{default:r((()=>[u(o,{modelValue:j.request,"onUpdate:modelValue":l[14]||(l[14]=e=>j.request=e),type:"textarea",rows:5,placeholder:"gRPC请求内容，支持JSON格式"},null,8,["modelValue"])])),_:1}),u(s,{label:"请求超时",prop:"config.timeout"},{default:r((()=>[u(_,{modelValue:j.timeout,"onUpdate:modelValue":l[15]||(l[15]=e=>j.timeout=e),min:1,max:60,step:1,"controls-position":"right"},null,8,["modelValue"]),l[24]||(l[24]=v("span",{class:"ml-10"},"秒",-1))])),_:1})],64)):V("",!0),u(s,null,{default:r((()=>[u(k,{type:"primary",onClick:G,loading:q.value},{default:r((()=>l[25]||(l[25]=[c("保存")]))),_:1},8,["loading"]),u(k,{onClick:S},{default:r((()=>l[26]||(l[26]=[c("取消")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])}}}),[["__scopeId","data-v-9cf4a895"]]);export{E as default};
