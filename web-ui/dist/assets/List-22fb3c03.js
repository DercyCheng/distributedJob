import{d as e,a,r as l,j as t,c as s,e as o,w as i,E as r,g as d,p as n,o as u,h as p,i as c,b as m,q as g,l as f,t as v,y as h,_ as y}from"./index-462fafd6.js";import{g as b,a as _,b as w,d as k,u as V,c as C}from"./role-b69c4f5a.js";const x={class:"role-list-container"},z={class:"card-header"},S={class:"pagination-container"},U={class:"dialog-footer"},K=y(e({__name:"List",setup(e){const y=a(!1),K=a([]),j=a([]),q=a(),T=a(),B=l({page:1,pageSize:10,name:"",status:""}),R=l({page:1,pageSize:10,total:0}),A=a(!1),E=a(!1),H=l({id:0,name:"",description:"",status:"active",permissions:[]}),I={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"},{max:200,message:"长度不能超过 200 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择角色状态",trigger:"change"}]},L=async()=>{y.value=!0;try{const e={page:R.page,pageSize:R.pageSize};B.name&&(e.name=B.name),B.status&&(e.status=B.status);const a=await b(e);K.value=a.list,R.total=a.total}catch(e){r.error("获取角色列表失败")}finally{y.value=!1}},P=()=>{R.page=1,L()},$=()=>{B.name="",B.status="",P()},D=e=>{R.pageSize=e,L()},F=e=>{R.page=e,L()},G=()=>{E.value=!1,H.id=0,H.name="",H.description="",H.status="active",H.permissions=[],T.value&&T.value.setCheckedKeys([]),A.value=!0},J=async()=>{q.value&&T.value&&await q.value.validate((async e=>{if(e)try{const e=T.value.getCheckedKeys(!1),a=T.value.getHalfCheckedKeys(),l=[...e,...a],t={name:H.name,description:H.description,status:H.status,permissions:l.map((e=>({id:e})))};E.value?(await V(H.id,t),r.success("角色更新成功")):(await C(t),r.success("角色创建成功")),A.value=!1,L()}catch(a){r.error("保存角色失败")}}))};return t((()=>{L(),(async()=>{try{j.value=await _()}catch(e){r.error("获取权限列表失败")}})()})),(e,a)=>{const l=d("el-input"),t=d("el-form-item"),b=d("el-option"),_=d("el-select"),V=d("el-button"),C=d("el-form"),M=d("el-card"),N=d("el-table-column"),O=d("el-tag"),Q=d("el-table"),W=d("el-pagination"),X=d("el-radio"),Y=d("el-radio-group"),Z=d("el-tree"),ee=d("el-dialog"),ae=n("loading");return u(),s("div",x,[o(M,{shadow:"never",class:"filter-container"},{default:i((()=>[o(C,{model:B,inline:""},{default:i((()=>[o(t,{label:"角色名称"},{default:i((()=>[o(l,{modelValue:B.name,"onUpdate:modelValue":a[0]||(a[0]=e=>B.name=e),placeholder:"请输入角色名称",clearable:"",onKeyup:p(P,["enter"])},null,8,["modelValue"])])),_:1}),o(t,{label:"状态"},{default:i((()=>[o(_,{modelValue:B.status,"onUpdate:modelValue":a[1]||(a[1]=e=>B.status=e),placeholder:"请选择状态",clearable:""},{default:i((()=>[o(b,{label:"启用",value:"active"}),o(b,{label:"禁用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1}),o(t,null,{default:i((()=>[o(V,{type:"primary",onClick:P},{default:i((()=>a[9]||(a[9]=[c("查询")]))),_:1}),o(V,{onClick:$},{default:i((()=>a[10]||(a[10]=[c("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),o(M,{shadow:"never",class:"table-container"},{header:i((()=>[m("div",z,[a[12]||(a[12]=m("span",null,"角色列表",-1)),o(V,{type:"primary",onClick:G},{default:i((()=>a[11]||(a[11]=[c("创建角色")]))),_:1})])])),default:i((()=>[g((u(),f(Q,{data:K.value,border:"",style:{width:"100%"}},{default:i((()=>[o(N,{prop:"name",label:"角色名称","min-width":"150","show-overflow-tooltip":""}),o(N,{prop:"description",label:"角色描述","min-width":"200","show-overflow-tooltip":""}),o(N,{prop:"status",label:"状态",width:"100"},{default:i((e=>[o(O,{type:"active"===e.row.status?"success":"info"},{default:i((()=>[c(v("active"===e.row.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),o(N,{prop:"createdAt",label:"创建时间",width:"180","show-overflow-tooltip":""}),o(N,{label:"操作",width:"180",fixed:"right"},{default:i((e=>[o(V,{type:"primary",link:"",onClick:a=>(async e=>{E.value=!0,H.id=e.id;try{const a=await w(e.id);H.name=a.name,H.description=a.description,H.status=a.status,H.permissions=a.permissions.map((e=>e.id)),T.value&&T.value.setCheckedKeys(H.permissions),A.value=!0}catch(a){r.error("获取角色详情失败")}})(e.row)},{default:i((()=>a[13]||(a[13]=[c(" 编辑 ")]))),_:2},1032,["onClick"]),o(V,{type:"danger",link:"",onClick:a=>{return l=e.row,void h.confirm(`确定要删除角色"${l.name}"吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await k(l.id),r.success("删除成功"),L()}catch(e){r.error("删除角色失败")}}));var l}},{default:i((()=>a[14]||(a[14]=[c(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ae,y.value]]),m("div",S,[o(W,{"current-page":R.page,"onUpdate:currentPage":a[2]||(a[2]=e=>R.page=e),"page-size":R.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>R.pageSize=e),total:R.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:D,onCurrentChange:F},null,8,["current-page","page-size","total"])])])),_:1}),o(ee,{modelValue:A.value,"onUpdate:modelValue":a[8]||(a[8]=e=>A.value=e),title:E.value?"编辑角色":"新建角色",width:"700px","append-to-body":""},{footer:i((()=>[m("div",U,[o(V,{onClick:a[7]||(a[7]=e=>A.value=!1)},{default:i((()=>a[17]||(a[17]=[c("取消")]))),_:1}),o(V,{type:"primary",onClick:J},{default:i((()=>a[18]||(a[18]=[c("确定")]))),_:1})])])),default:i((()=>[o(C,{ref_key:"formRef",ref:q,model:H,rules:I,"label-width":"100px","label-position":"right"},{default:i((()=>[o(t,{label:"角色名称",prop:"name"},{default:i((()=>[o(l,{modelValue:H.name,"onUpdate:modelValue":a[4]||(a[4]=e=>H.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),o(t,{label:"角色描述",prop:"description"},{default:i((()=>[o(l,{modelValue:H.description,"onUpdate:modelValue":a[5]||(a[5]=e=>H.description=e),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])])),_:1}),o(t,{label:"状态",prop:"status"},{default:i((()=>[o(Y,{modelValue:H.status,"onUpdate:modelValue":a[6]||(a[6]=e=>H.status=e)},{default:i((()=>[o(X,{label:"active"},{default:i((()=>a[15]||(a[15]=[c("启用")]))),_:1}),o(X,{label:"disabled"},{default:i((()=>a[16]||(a[16]=[c("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),o(t,{label:"权限分配",prop:"permissions"},{default:i((()=>[o(Z,{ref_key:"permissionTreeRef",ref:T,data:j.value,props:{label:"name",children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":""},null,8,["data"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-32c9afb2"]]);export{K as default};
