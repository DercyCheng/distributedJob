import{d as e,a,r as l,j as t,B as s,c as d,e as o,w as r,f as u,A as i,E as n,g as p,p as c,o as m,F as v,m as g,i as f,b as w,q as b,l as h,t as y,_}from"./index-462fafd6.js";import{g as k,e as I}from"./record-f885688b.js";import{g as z}from"./task-3c60f998.js";import{g as S}from"./department-10f40862.js";const V={class:"record-list-container"},U={class:"pagination-container"},j=_(e({__name:"List",setup(e){const _=u(),j=i(),C=a(!1),Y=a(!1),x=a([]),T=a([]),D=a([]),L=a(null),q=l({taskId:void 0,status:"",departmentId:void 0}),H=l({page:1,pageSize:10,total:0}),M=async()=>{C.value=!0;try{const e=L.value?L.value[0]:void 0,a=L.value?L.value[1]:void 0,l=await k({page:H.page,pageSize:H.pageSize,taskId:q.taskId,status:q.status||void 0,departmentId:q.departmentId,startTime:e,endTime:a});x.value=l.list,H.total=l.total}catch(e){n.error("获取执行记录列表失败")}finally{C.value=!1}},R=()=>{H.page=1,M()},N=()=>{q.taskId=void 0,q.status="",q.departmentId=void 0,L.value=null,R()},O=e=>{H.pageSize=e,M()},E=e=>{H.page=e,M()},$=async()=>{try{const e=L.value?L.value[0]:void 0,a=L.value?L.value[1]:void 0,l=await I({page:1,pageSize:1e4,taskId:q.taskId,status:q.status||void 0,departmentId:q.departmentId,startTime:e,endTime:a}),t=window.URL.createObjectURL(l),s=document.createElement("a");s.href=t,s.download=`执行记录_${(new Date).toISOString().slice(0,10)}.xlsx`,s.click(),window.URL.revokeObjectURL(t),n.success("导出成功")}catch(e){n.error("导出执行记录失败")}},A=()=>{j.query.taskId&&(q.taskId=Number(j.query.taskId))};return t((()=>{A(),(async()=>{Y.value=!0;try{const e=await z({page:1,pageSize:1e3});T.value=e.list}catch(e){}finally{Y.value=!1}})(),(async()=>{try{const e=await S();D.value=e}catch(e){}})(),M()})),s((()=>j.query),A,{immediate:!0}),(e,a)=>{const l=p("el-option"),t=p("el-select"),s=p("el-form-item"),u=p("el-date-picker"),i=p("el-button"),n=p("el-form"),k=p("el-card"),I=p("el-table-column"),z=p("el-tag"),S=p("el-table"),j=p("el-pagination"),M=c("loading");return m(),d("div",V,[o(k,{shadow:"never",class:"filter-container"},{default:r((()=>[o(n,{model:q,inline:""},{default:r((()=>[o(s,{label:"任务名称"},{default:r((()=>[o(t,{modelValue:q.taskId,"onUpdate:modelValue":a[0]||(a[0]=e=>q.taskId=e),placeholder:"请选择任务",clearable:"",filterable:"",loading:Y.value},{default:r((()=>[(m(!0),d(v,null,g(T.value,(e=>(m(),h(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),o(s,{label:"执行状态"},{default:r((()=>[o(t,{modelValue:q.status,"onUpdate:modelValue":a[1]||(a[1]=e=>q.status=e),placeholder:"请选择状态",clearable:""},{default:r((()=>[o(l,{label:"成功",value:"success"}),o(l,{label:"失败",value:"fail"})])),_:1},8,["modelValue"])])),_:1}),o(s,{label:"所属部门"},{default:r((()=>[o(t,{modelValue:q.departmentId,"onUpdate:modelValue":a[2]||(a[2]=e=>q.departmentId=e),placeholder:"请选择部门",clearable:""},{default:r((()=>[(m(!0),d(v,null,g(D.value,(e=>(m(),h(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(s,{label:"执行时间"},{default:r((()=>[o(u,{modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])])),_:1}),o(s,null,{default:r((()=>[o(i,{type:"primary",onClick:R},{default:r((()=>a[6]||(a[6]=[f("查询")]))),_:1}),o(i,{onClick:N},{default:r((()=>a[7]||(a[7]=[f("重置")]))),_:1}),o(i,{type:"success",onClick:$},{default:r((()=>a[8]||(a[8]=[f("导出")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),o(k,{shadow:"never",class:"table-container"},{header:r((()=>a[9]||(a[9]=[w("div",{class:"card-header"},[w("span",null,"执行记录列表")],-1)]))),default:r((()=>[b((m(),h(S,{data:x.value,border:"",style:{width:"100%"}},{default:r((()=>[o(I,{prop:"taskName",label:"任务名称","min-width":"150","show-overflow-tooltip":""}),o(I,{prop:"departmentName",label:"所属部门",width:"120","show-overflow-tooltip":""}),o(I,{prop:"startTime",label:"开始时间",width:"180","show-overflow-tooltip":""}),o(I,{prop:"endTime",label:"结束时间",width:"180","show-overflow-tooltip":""}),o(I,{prop:"duration",label:"耗时(ms)",width:"100"}),o(I,{prop:"status",label:"状态",width:"100"},{default:r((e=>[o(z,{type:"success"===e.row.status?"success":"danger"},{default:r((()=>[f(y("success"===e.row.status?"成功":"失败"),1)])),_:2},1032,["type"])])),_:1}),o(I,{label:"操作",width:"120",fixed:"right"},{default:r((e=>[o(i,{type:"primary",link:"",onClick:a=>{return l=e.row,void _.push(`/record/detail/${l.id}`);var l}},{default:r((()=>a[10]||(a[10]=[f("查看详情")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[M,C.value]]),w("div",U,[o(j,{"current-page":H.page,"onUpdate:currentPage":a[4]||(a[4]=e=>H.page=e),"page-size":H.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>H.pageSize=e),total:H.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:E},null,8,["current-page","page-size","total"])])])),_:1})])}}}),[["__scopeId","data-v-4cb19c53"]]);export{j as default};
