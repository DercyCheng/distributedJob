import{d as e,a,r as t,j as l,c as o,e as s,w as r,f as d,E as n,g as i,p,o as u,h as c,F as m,m as v,i as h,b as f,q as g,l as y,t as w,y as b,_}from"./index-462fafd6.js";import{g as k,r as C,p as V,d as z,e as S}from"./task-3c60f998.js";import{g as I}from"./department-10f40862.js";const U={class:"task-list-container"},x={class:"card-header"},T={class:"pagination-container"},j=_(e({__name:"List",setup(e){const _=d(),j=a(!1),P=a([]),q=a([]),B=t({name:"",type:"",status:"",departmentId:void 0}),E=t({page:1,pageSize:10,total:0}),H=async()=>{j.value=!0;try{const e=await k({page:E.page,pageSize:E.pageSize,name:B.name||void 0,type:B.type||void 0,status:B.status||void 0,departmentId:B.departmentId});P.value=e.list,E.total=e.total}catch(e){n.error("获取任务列表失败")}finally{j.value=!1}},N=()=>{E.page=1,H()},R=()=>{B.name="",B.type="",B.status="",B.departmentId=void 0,N()},$=e=>{E.pageSize=e,H()},A=e=>{E.page=e,H()},F=()=>{_.push("/task/create")};return l((()=>{H(),(async()=>{try{const e=await I();q.value=e}catch(e){}})()})),(e,a)=>{const t=i("el-input"),l=i("el-form-item"),d=i("el-option"),k=i("el-select"),I=i("el-button"),K=i("el-form"),L=i("el-card"),D=i("el-table-column"),G=i("el-tag"),J=i("el-switch"),M=i("el-table"),O=i("el-pagination"),Q=p("loading");return u(),o("div",U,[s(L,{shadow:"never",class:"filter-container"},{default:r((()=>[s(K,{model:B,inline:""},{default:r((()=>[s(l,{label:"任务名称"},{default:r((()=>[s(t,{modelValue:B.name,"onUpdate:modelValue":a[0]||(a[0]=e=>B.name=e),placeholder:"请输入任务名称",clearable:"",onKeyup:c(N,["enter"])},null,8,["modelValue"])])),_:1}),s(l,{label:"任务类型"},{default:r((()=>[s(k,{modelValue:B.type,"onUpdate:modelValue":a[1]||(a[1]=e=>B.type=e),placeholder:"请选择任务类型",clearable:""},{default:r((()=>[s(d,{label:"HTTP",value:"http"}),s(d,{label:"gRPC",value:"grpc"})])),_:1},8,["modelValue"])])),_:1}),s(l,{label:"任务状态"},{default:r((()=>[s(k,{modelValue:B.status,"onUpdate:modelValue":a[2]||(a[2]=e=>B.status=e),placeholder:"请选择任务状态",clearable:""},{default:r((()=>[s(d,{label:"运行中",value:"active"}),s(d,{label:"已暂停",value:"paused"})])),_:1},8,["modelValue"])])),_:1}),s(l,{label:"所属部门"},{default:r((()=>[s(k,{modelValue:B.departmentId,"onUpdate:modelValue":a[3]||(a[3]=e=>B.departmentId=e),placeholder:"请选择部门",clearable:""},{default:r((()=>[(u(!0),o(m,null,v(q.value,(e=>(u(),y(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(l,null,{default:r((()=>[s(I,{type:"primary",onClick:N},{default:r((()=>a[6]||(a[6]=[h("查询")]))),_:1}),s(I,{onClick:R},{default:r((()=>a[7]||(a[7]=[h("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(L,{shadow:"never",class:"table-container"},{header:r((()=>[f("div",x,[a[9]||(a[9]=f("span",null,"任务列表",-1)),f("div",null,[s(I,{type:"primary",onClick:F},{default:r((()=>a[8]||(a[8]=[h("创建任务")]))),_:1})])])])),default:r((()=>[g((u(),y(M,{data:P.value,border:"",style:{width:"100%"}},{default:r((()=>[s(D,{prop:"name",label:"任务名称","min-width":"150","show-overflow-tooltip":""}),s(D,{prop:"type",label:"任务类型",width:"100"},{default:r((e=>[s(G,{type:"http"===e.row.type?"primary":"success"},{default:r((()=>[h(w("http"===e.row.type?"HTTP":"gRPC"),1)])),_:2},1032,["type"])])),_:1}),s(D,{prop:"cronExpression",label:"执行计划",width:"150","show-overflow-tooltip":""}),s(D,{prop:"departmentName",label:"所属部门",width:"120","show-overflow-tooltip":""}),s(D,{prop:"status",label:"状态",width:"100"},{default:r((e=>[s(J,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":"active","inactive-value":"paused",onChange:a=>(async e=>{const a=e.status,t="active"===a?"paused":"active";e.status=t;try{"active"===t?(await C(e.id),n.success("任务已启用")):(await V(e.id),n.success("任务已暂停"))}catch(l){n.error("更改任务状态失败"),e.status=a,H()}})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),s(D,{prop:"creatorName",label:"创建人",width:"120","show-overflow-tooltip":""}),s(D,{prop:"createdAt",label:"创建时间",width:"180","show-overflow-tooltip":""}),s(D,{label:"操作",width:"220",fixed:"right"},{default:r((e=>[s(I,{type:"primary",link:"",onClick:a=>{return t=e.row,void _.push(`/task/edit/${t.id}`);var t}},{default:r((()=>a[10]||(a[10]=[h("编辑")]))),_:2},1032,["onClick"]),s(I,{type:"primary",link:"",onClick:a=>{return t=e.row,void _.push({path:"/record/list",query:{taskId:t.id.toString()}});var t}},{default:r((()=>a[11]||(a[11]=[h("执行记录")]))),_:2},1032,["onClick"]),s(I,{type:"success",link:"",onClick:a=>(async e=>{try{await S(e.id),n.success("已触发任务执行")}catch(a){n.error("触发任务执行失败")}})(e.row)},{default:r((()=>a[12]||(a[12]=[h("立即执行")]))),_:2},1032,["onClick"]),s(I,{type:"danger",link:"",onClick:a=>{return t=e.row,void b.confirm(`确定要删除任务"${t.name}"吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await z(t.id),n.success("删除成功"),H()}catch(e){n.error("删除任务失败")}}));var t}},{default:r((()=>a[13]||(a[13]=[h("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Q,j.value]]),f("div",T,[s(O,{"current-page":E.page,"onUpdate:currentPage":a[4]||(a[4]=e=>E.page=e),"page-size":E.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>E.pageSize=e),total:E.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:A},null,8,["current-page","page-size","total"])])])),_:1})])}}}),[["__scopeId","data-v-a815735b"]]);export{j as default};
