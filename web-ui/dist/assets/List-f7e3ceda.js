import{C as e,d as a,a as l,r as t,j as r,c as d,e as o,w as s,E as u,g as n,p as i,o as m,h as p,F as c,m as v,i as w,b as g,q as f,l as b,n as h,y,_ as V}from"./index-462fafd6.js";import{g as _}from"./department-10f40862.js";import{g as I}from"./role-b69c4f5a.js";const k={class:"user-list-container"},C={class:"card-header"},U={class:"pagination-container"},z={class:"dialog-footer"},x={class:"dialog-footer"},q=V(a({__name:"List",setup(a){const V=l(!1),q=l([]),S=l([]),P=l([]),j=t({page:1,pageSize:10,username:"",name:"",departmentId:void 0,roleId:void 0,status:""}),$=t({page:1,pageSize:10,total:0}),B=l(!1),E=l(!1),F=l(),K=t({id:0,username:"",name:"",email:"",password:"",departmentId:void 0,roleId:void 0,status:"active"}),N=t({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:30,message:"长度在 3 到 30 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}]}),R=l(!1),T=l(),A=l(0),L=t({password:"",confirmPassword:""}),D=t({password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==L.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]}),G=async()=>{V.value=!0;try{const a={page:$.page,pageSize:$.pageSize};j.username&&(a.username=j.username),j.name&&(a.name=j.name),j.departmentId&&(a.departmentId=j.departmentId),j.roleId&&(a.roleId=j.roleId),j.status&&(a.status=j.status);const l=await function(a){return e.get("/users",{params:a})}(a);q.value=l.list,$.total=l.total}catch(a){u.error("获取用户列表失败")}finally{V.value=!1}},H=()=>{$.page=1,G()},J=()=>{j.username="",j.name="",j.departmentId=void 0,j.roleId=void 0,j.status="",H()},M=e=>{$.pageSize=e,G()},O=e=>{$.page=e,G()},Q=()=>{E.value=!1,K.id=0,K.username="",K.name="",K.email="",K.password="",K.departmentId=void 0,K.roleId=void 0,K.status="active",B.value=!0},W=async()=>{T.value&&await T.value.validate((async a=>{if(a)try{await(l=A.value,t=L.password,e.put(`/users/${l}/reset-password`,{password:t})),u.success("密码重置成功"),R.value=!1}catch(r){u.error("密码重置失败")}var l,t}))},X=async a=>{try{await(l=a.id,t=a.status,e.put(`/users/${l}/status`,{status:t})),u.success("用户已"+("active"===a.status?"启用":"禁用"))}catch(r){u.error("更改用户状态失败"),a.status="active"===a.status?"disabled":"active"}var l,t},Y=a=>{y.confirm(`确定要删除用户"${a.name}"吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await(l=a.id,e.delete(`/users/${l}`)),u.success("删除成功"),G()}catch(t){u.error("删除用户失败")}var l}))},Z=async()=>{F.value&&await F.value.validate((async a=>{if(a)try{if(E.value){const a={name:K.name,email:K.email,departmentId:K.departmentId,roleId:K.roleId,status:K.status};await(l=K.id,t=a,e.put(`/users/${l}`,t)),u.success("用户更新成功")}else await function(a){return e.post("/users",a)}({username:K.username,name:K.name,email:K.email,password:K.password,departmentId:K.departmentId,roleId:K.roleId,status:K.status}),u.success("用户创建成功");B.value=!1,G()}catch(r){u.error("保存用户失败")}var l,t}))};return r((()=>{G(),(async()=>{try{const e=await _();S.value=e}catch(e){u.error("获取部门列表失败")}})(),(async()=>{try{const e=await I();P.value=e}catch(e){u.error("获取角色列表失败")}})()})),(e,a)=>{const l=n("el-input"),t=n("el-form-item"),r=n("el-option"),u=n("el-select"),y=n("el-button"),_=n("el-form"),I=n("el-card"),G=n("el-table-column"),ee=n("el-switch"),ae=n("el-table"),le=n("el-pagination"),te=n("el-dialog"),re=i("loading");return m(),d("div",k,[o(I,{shadow:"never",class:"filter-container"},{default:s((()=>[o(_,{model:j,inline:""},{default:s((()=>[o(t,{label:"用户名"},{default:s((()=>[o(l,{modelValue:j.username,"onUpdate:modelValue":a[0]||(a[0]=e=>j.username=e),placeholder:"请输入用户名",clearable:"",onKeyup:p(H,["enter"])},null,8,["modelValue"])])),_:1}),o(t,{label:"姓名"},{default:s((()=>[o(l,{modelValue:j.name,"onUpdate:modelValue":a[1]||(a[1]=e=>j.name=e),placeholder:"请输入姓名",clearable:"",onKeyup:p(H,["enter"])},null,8,["modelValue"])])),_:1}),o(t,{label:"部门"},{default:s((()=>[o(u,{modelValue:j.departmentId,"onUpdate:modelValue":a[2]||(a[2]=e=>j.departmentId=e),placeholder:"请选择部门",clearable:""},{default:s((()=>[(m(!0),d(c,null,v(S.value,(e=>(m(),b(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(t,{label:"角色"},{default:s((()=>[o(u,{modelValue:j.roleId,"onUpdate:modelValue":a[3]||(a[3]=e=>j.roleId=e),placeholder:"请选择角色",clearable:""},{default:s((()=>[(m(!0),d(c,null,v(P.value,(e=>(m(),b(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(t,{label:"状态"},{default:s((()=>[o(u,{modelValue:j.status,"onUpdate:modelValue":a[4]||(a[4]=e=>j.status=e),placeholder:"请选择状态",clearable:""},{default:s((()=>[o(r,{label:"启用",value:"active"}),o(r,{label:"禁用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1}),o(t,null,{default:s((()=>[o(y,{type:"primary",onClick:H},{default:s((()=>a[19]||(a[19]=[w("查询")]))),_:1}),o(y,{onClick:J},{default:s((()=>a[20]||(a[20]=[w("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),o(I,{shadow:"never",class:"table-container"},{header:s((()=>[g("div",C,[a[22]||(a[22]=g("span",null,"用户列表",-1)),o(y,{type:"primary",onClick:Q},{default:s((()=>a[21]||(a[21]=[w("创建用户")]))),_:1})])])),default:s((()=>[f((m(),b(ae,{data:q.value,border:"",style:{width:"100%"}},{default:s((()=>[o(G,{prop:"username",label:"用户名","min-width":"120","show-overflow-tooltip":""}),o(G,{prop:"name",label:"姓名","min-width":"120","show-overflow-tooltip":""}),o(G,{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}),o(G,{prop:"departmentName",label:"部门","min-width":"120","show-overflow-tooltip":""}),o(G,{prop:"roleName",label:"角色","min-width":"120","show-overflow-tooltip":""}),o(G,{prop:"status",label:"状态",width:"100"},{default:s((e=>[o(ee,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":"active","inactive-value":"disabled",onChange:()=>X(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),o(G,{prop:"createdAt",label:"创建时间",width:"180","show-overflow-tooltip":""}),o(G,{label:"操作",width:"220",fixed:"right"},{default:s((e=>[o(y,{type:"primary",link:"",onClick:a=>{return l=e.row,E.value=!0,K.id=l.id,K.username=l.username,K.name=l.name,K.email=l.email,K.password="",K.departmentId=l.departmentId,K.roleId=l.roleId,K.status=l.status,void(B.value=!0);var l}},{default:s((()=>a[23]||(a[23]=[w(" 编辑 ")]))),_:2},1032,["onClick"]),o(y,{type:"warning",link:"",onClick:a=>{return l=e.row,L.password="",L.confirmPassword="",A.value=l.id,void(R.value=!0);var l}},{default:s((()=>a[24]||(a[24]=[w(" 重置密码 ")]))),_:2},1032,["onClick"]),o(y,{type:"danger",link:"",onClick:a=>Y(e.row)},{default:s((()=>a[25]||(a[25]=[w(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[re,V.value]]),g("div",U,[o(le,{"current-page":$.page,"onUpdate:currentPage":a[5]||(a[5]=e=>$.page=e),"page-size":$.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>$.pageSize=e),total:$.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:O},null,8,["current-page","page-size","total"])])])),_:1}),o(te,{modelValue:B.value,"onUpdate:modelValue":a[14]||(a[14]=e=>B.value=e),title:E.value?"编辑用户":"新建用户",width:"500px","append-to-body":""},{footer:s((()=>[g("div",z,[o(y,{onClick:a[13]||(a[13]=e=>B.value=!1)},{default:s((()=>a[26]||(a[26]=[w("取消")]))),_:1}),o(y,{type:"primary",onClick:Z},{default:s((()=>a[27]||(a[27]=[w("确定")]))),_:1})])])),default:s((()=>[o(_,{ref_key:"formRef",ref:F,model:K,rules:N,"label-width":"80px","label-position":"right"},{default:s((()=>[E.value?h("",!0):(m(),b(t,{key:0,label:"用户名",prop:"username"},{default:s((()=>[o(l,{modelValue:K.username,"onUpdate:modelValue":a[7]||(a[7]=e=>K.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1})),o(t,{label:"姓名",prop:"name"},{default:s((()=>[o(l,{modelValue:K.name,"onUpdate:modelValue":a[8]||(a[8]=e=>K.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),o(t,{label:"邮箱",prop:"email"},{default:s((()=>[o(l,{modelValue:K.email,"onUpdate:modelValue":a[9]||(a[9]=e=>K.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),E.value?h("",!0):(m(),b(t,{key:1,label:"密码",prop:"password"},{default:s((()=>[o(l,{modelValue:K.password,"onUpdate:modelValue":a[10]||(a[10]=e=>K.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})),o(t,{label:"部门",prop:"departmentId"},{default:s((()=>[o(u,{modelValue:K.departmentId,"onUpdate:modelValue":a[11]||(a[11]=e=>K.departmentId=e),placeholder:"请选择部门",style:{width:"100%"}},{default:s((()=>[(m(!0),d(c,null,v(S.value,(e=>(m(),b(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(t,{label:"角色",prop:"roleId"},{default:s((()=>[o(u,{modelValue:K.roleId,"onUpdate:modelValue":a[12]||(a[12]=e=>K.roleId=e),placeholder:"请选择角色",style:{width:"100%"}},{default:s((()=>[(m(!0),d(c,null,v(P.value,(e=>(m(),b(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),o(te,{modelValue:R.value,"onUpdate:modelValue":a[18]||(a[18]=e=>R.value=e),title:"重置密码",width:"500px","append-to-body":""},{footer:s((()=>[g("div",x,[o(y,{onClick:a[17]||(a[17]=e=>R.value=!1)},{default:s((()=>a[28]||(a[28]=[w("取消")]))),_:1}),o(y,{type:"primary",onClick:W},{default:s((()=>a[29]||(a[29]=[w("确定")]))),_:1})])])),default:s((()=>[o(_,{ref_key:"resetFormRef",ref:T,model:L,rules:D,"label-width":"80px"},{default:s((()=>[o(t,{label:"新密码",prop:"password"},{default:s((()=>[o(l,{modelValue:L.password,"onUpdate:modelValue":a[15]||(a[15]=e=>L.password=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])])),_:1}),o(t,{label:"确认密码",prop:"confirmPassword"},{default:s((()=>[o(l,{modelValue:L.confirmPassword,"onUpdate:modelValue":a[16]||(a[16]=e=>L.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f29a8908"]]);export{q as default};
