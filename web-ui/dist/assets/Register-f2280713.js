import{d as e,u as a,r,a as l,j as s,c as o,b as d,e as t,w as u,f as i,v as n,k as m,E as p,g,o as c,l as f,F as w,m as v,n as h,i as y,_ as b}from"./index-462fafd6.js";import{g as V}from"./department-10f40862.js";import{g as _}from"./role-b69c4f5a.js";const I={class:"register-container"},k={class:"register-box"},U={class:"login-link"},x=b(e({__name:"Register",setup(e){const b=i(),x=a(),q=r({username:"",name:"",email:"",password:"",confirmPassword:"",departmentId:void 0,roleId:void 0}),E=l([]),P=l([]),j={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:(e,a,r)=>{a?n(a)?r():r(new Error("用户名格式不正确（4-16位字母、数字、下划线或短横线）")):r(new Error("请输入用户名"))},trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,message:"姓名长度不能少于2个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码长度不能少于8个字符",trigger:"blur"},{validator:(e,a,r)=>{a?m(a)?r():r(new Error("密码格式不正确（至少8位，必须包含字母和数字）")):r(new Error("请输入密码"))},trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,a,r)=>{a!==q.password?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}]},F=l(),C=l(!1),L=async()=>{F.value&&await F.value.validate((async e=>{if(e){C.value=!0;try{const e=await x.register({username:q.username,name:q.name,email:q.email,password:q.password,departmentId:q.departmentId,roleId:q.roleId});e&&e.accessToken?(p.success("注册成功，即将进入系统"),b.push({path:"/"})):(p.success("注册成功，请登录"),b.push({path:"/login"}))}catch(a){if(a.response&&a.response.data){const e=a.response.data;e.message?p.error(e.message):p.error("注册失败，请稍后重试")}else a.message?p.error(a.message):p.error("注册失败，请稍后重试")}finally{C.value=!1}}}))},R=()=>{b.push({path:"/login"})};return s((()=>{(async()=>{try{const e=await V();E.value=e}catch(e){p.error("获取部门列表失败")}})(),(async()=>{try{const e=await _();P.value=e}catch(e){p.error("获取角色列表失败")}})()})),(e,a)=>{const r=g("el-input"),l=g("el-form-item"),s=g("el-option"),i=g("el-select"),n=g("el-button"),m=g("el-link"),p=g("el-form");return c(),o("div",I,[d("div",k,[a[10]||(a[10]=d("div",{class:"register-title"},[d("h1",null,"DistributedJob"),d("p",null,"分布式任务调度系统")],-1)),t(p,{ref_key:"registerFormRef",ref:F,model:q,rules:j,class:"register-form"},{default:u((()=>[t(l,{prop:"username"},{default:u((()=>[t(r,{modelValue:q.username,"onUpdate:modelValue":a[0]||(a[0]=e=>q.username=e),placeholder:"用户名","prefix-icon":"User"},null,8,["modelValue"])])),_:1}),t(l,{prop:"name"},{default:u((()=>[t(r,{modelValue:q.name,"onUpdate:modelValue":a[1]||(a[1]=e=>q.name=e),placeholder:"姓名","prefix-icon":"UserFilled"},null,8,["modelValue"])])),_:1}),t(l,{prop:"email"},{default:u((()=>[t(r,{modelValue:q.email,"onUpdate:modelValue":a[2]||(a[2]=e=>q.email=e),placeholder:"邮箱","prefix-icon":"Message"},null,8,["modelValue"])])),_:1}),t(l,{prop:"password"},{default:u((()=>[t(r,{modelValue:q.password,"onUpdate:modelValue":a[3]||(a[3]=e=>q.password=e),placeholder:"密码","prefix-icon":"Lock",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),t(l,{prop:"confirmPassword"},{default:u((()=>[t(r,{modelValue:q.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>q.confirmPassword=e),placeholder:"确认密码","prefix-icon":"Lock",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),E.value.length>0?(c(),f(l,{key:0,prop:"departmentId"},{default:u((()=>[t(i,{modelValue:q.departmentId,"onUpdate:modelValue":a[5]||(a[5]=e=>q.departmentId=e),placeholder:"请选择部门",style:{width:"100%"}},{default:u((()=>[(c(!0),o(w,null,v(E.value,(e=>(c(),f(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):h("",!0),P.value.length>0?(c(),f(l,{key:1,prop:"roleId"},{default:u((()=>[t(i,{modelValue:q.roleId,"onUpdate:modelValue":a[6]||(a[6]=e=>q.roleId=e),placeholder:"请选择角色",style:{width:"100%"}},{default:u((()=>[(c(!0),o(w,null,v(P.value,(e=>(c(),f(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):h("",!0),t(l,null,{default:u((()=>[t(n,{loading:C.value,type:"primary",class:"register-button",onClick:L},{default:u((()=>a[7]||(a[7]=[y(" 注册 ")]))),_:1},8,["loading"])])),_:1}),d("div",U,[a[9]||(a[9]=y(" 已有账号？")),t(m,{type:"primary",onClick:R},{default:u((()=>a[8]||(a[8]=[y("立即登录")]))),_:1})])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-947f2105"]]);export{x as default};
